# Безопасностные меры для приложения перевода голоса

## Общие принципы безопасности

Приложение реализует безопасность на нескольких уровнях:
- Защита API ключей OpenAI
- Защита передаваемых данных
- Защита от атак на сервер
- Конфиденциальность пользовательских данных

## Хранение API ключей OpenAI

### Серверное хранение
- API ключи OpenAI хранятся исключительно на сервере в переменных окружения
- Файл `.env` содержит `OPENAI_API_KEY` и исключен из системы контроля версий
- Никакие API ключи не передаются на клиентскую сторону

### Прокси-сервер
- Все запросы к OpenAI API проходят через серверный прокси
- Клиент не имеет прямого доступа к API ключам
- Прокси-сервер реализован в файле `utils/openai-proxy.js`

## Защита передаваемых данных

### Шифрование
- WebRTC обеспечивает шифрование аудио данных между клиентами
- WebSocket соединения защищены TLS/SSL (при использовании wss://)
- Все HTTP запросы к API защищены HTTPS

### Защита от подделки запросов
- Валидация всех входящих данных на сервере
- Проверка типа и формата сообщений WebSocket
- Ограничение размера передаваемых данных

## Защита от атак на сервер

### Ограничение частоты запросов
- Реализация rate limiting для предотвращения DDoS атак
- Ограничение количества одновременных соединений на IP
- Ограничение частоты запросов к OpenAI API

### Валидация входящих данных
- Проверка всех входящих сообщений WebSocket
- Валидация SDP описаний WebRTC
- Проверка корректности формата данных

### Защита от злоупотребления API
- Ограничение количества запросов к OpenAI API на сессию
- Мониторинг использования API ключей
- Возможность временной блокировки подозрительных сессий

## Конфиденциальность пользовательских данных

### Отсутствие хранения персональных данных
- Приложение не требует регистрации и не хранит персональные данные
- Не сохраняются логи разговоров пользователей
- Не хранятся аудио записи разговоров

### Минимизация передаваемых данных
- Передаются только необходимые для функциональности данные
- Не передается информация о пользователе, кроме сессии
- Очистка данных после завершения сессии

## Безопасность клиентской части

### Защита от XSS
- Правильная экранизация выводимых данных
- Использование безопасных методов работы с DOM
- Ограничение встраивания контента из внешних источников

### Безопасность WebRTC
- Правильная обработка ICE кандидатов
- Проверка корректности SDP описаний
- Защита от подмены медиа потоков

## Файлы конфигурации безопасности

### .env
```
OPENAI_API_KEY=your_secret_openai_key_here
NODE_ENV=production
TRUST_PROXY=true
RATE_LIMIT_WINDOW_MS=15*60*1000  # 15 minutes
RATE_LIMIT_MAX=100 # limit each IP to 100 requests per windowMs
```

### security.config.js
```javascript
module.exports = {
  // Настройки CORS
  cors: {
    origin: process.env.ALLOWED_ORIGINS?.split(',') || ['http://localhost:3000'],
    credentials: true
  },
  
  // Настройки rate limiting
  rateLimit: {
    windowMs: parseInt(process.env.RATE_LIMIT_WINDOW_MS) || 15 * 60 * 1000, // 15 minutes
    max: parseInt(process.env.RATE_LIMIT_MAX) || 100 // limit each IP to 100 requests per windowMs
  },
  
  // Настройки безопасности сессий
  session: {
    secret: process.env.SESSION_SECRET || 'fallback_secret_for_dev',
    resave: false,
    saveUninitialized: false,
    cookie: {
      secure: process.env.NODE_ENV === 'production', // true в продакшене
      httpOnly: true,
      maxAge: 24 * 60 * 60 * 1000 // 24 часа
    }
  },
  
  // Настройки безопасности API
  apiSecurity: {
    maxAudioSize: '5mb',  // Максимальный размер аудио
    maxMessageSize: '1mb', // Максимальный размер сообщений
    sessionTimeout: 30 * 60 * 1000 // 30 минут
  }
};
```

## Мониторинг и логирование

### Логирование безопасности
- Логирование попыток несанкционированного доступа
- Мониторинг аномального поведения
- Логирование ошибок безопасности

### Оповещения
- Уведомления о подозрительной активности
- Оповещения о превышении лимитов использования API
- Мониторинг отказов в обслуживании

## Проверка безопасности

### Регулярные проверки
- Аудит безопасности кода
- Проверка на уязвимости
- Тестирование на проникновение

### Обновления
- Регулярное обновление зависимостей
- Мониторинг уязвимостей в используемых библиотеках
- Актуализация сертификатов